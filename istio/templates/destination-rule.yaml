# DestinationRule Template - Load Balancing and Circuit Breaker
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: example-destination-rule
  namespace: default
spec:
  host: example-service
  trafficPolicy:
    loadBalancer:
      simple: LEAST_CONN
    connectionPool:
      tcp:
        maxConnections: 10
        connectTimeout: 30s
        keepAlive:
          time: 7200s
          interval: 75s
      http:
        http1MaxPendingRequests: 10
        http2MaxRequests: 100
        maxRequestsPerConnection: 2
        maxRetries: 3
        idleTimeout: 90s
        h2UpgradePolicy: UPGRADE
    circuitBreaker:
      consecutiveGatewayErrors: 5
      consecutive5xxErrors: 5
      interval: 30s
      baseEjectionTime: 30s
      maxEjectionPercent: 50
      minHealthPercent: 30
  subsets:
  - name: v1
    labels:
      version: v1
    trafficPolicy:
      loadBalancer:
        simple: ROUND_ROBIN
  - name: v2
    labels:
      version: v2
    trafficPolicy:
      loadBalancer:
        simple: RANDOM
  - name: canary
    labels:
      version: canary
    trafficPolicy:
      loadBalancer:
        simple: PASSTHROUGH
---
# DestinationRule Template - mTLS Configuration
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: mtls-destination-rule
  namespace: default
spec:
  host: secure-service
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
      caCertificates: /etc/ssl/certs/ca.pem
      clientCertificate: /etc/ssl/certs/client.pem
      privateKey: /etc/ssl/private/client-key.pem
  subsets:
  - name: secure
    labels:
      security: high
    trafficPolicy:
      tls:
        mode: MUTUAL
        caCertificates: /etc/ssl/certs/ca.pem
        clientCertificate: /etc/ssl/certs/client.pem
        privateKey: /etc/ssl/private/client-key.pem
