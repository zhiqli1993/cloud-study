# Istio 核心组件

## 概述
Istio 是一个开源的服务网格（Service Mesh）平台，提供连接、保护、控制和观察服务的统一方式。它在不需要更改应用程序代码的情况下，为微服务架构提供流量管理、安全、可观测性等功能。

## 核心组件

### 1. 数据平面 (Data Plane)
数据平面由一组智能代理（Envoy）组成，这些代理部署为 sidecar，调解和控制微服务之间的所有网络通信。

#### Envoy Proxy
- **作用**: 作为 sidecar 代理，拦截进出服务的所有网络流量
- **功能**:
  - 负载均衡
  - 服务发现
  - 健康检查
  - 路由
  - 断路器
  - 故障注入
  - 丰富的指标收集

### 2. 控制平面 (Control Plane)
控制平面管理和配置代理路由流量，以及在运行时执行策略。

#### Istiod
Istiod 是 Istio 的核心控制平面组件，它将之前版本中的多个组件（Pilot、Citadel、Galley）整合为一个统一的二进制文件。

##### Pilot
- **作用**: 服务发现和流量管理
- **功能**:
  - 为 Envoy sidecar 提供服务发现
  - 流量管理能力（A/B测试、金丝雀部署等）
  - 弹性功能（超时、重试、断路器等）
  - 将高级路由规则转换为 Envoy 配置

##### Citadel (现已集成到 Istiod)
- **作用**: 证书和密钥管理
- **功能**:
  - 内置身份和凭证管理
  - 自动化证书生成、分发、轮换和撤销
  - 实现强大的服务间和最终用户身份验证

##### Galley (现已集成到 Istiod)
- **作用**: 配置验证、提取和分发
- **功能**:
  - 验证用户编写的 Istio API 配置
  - 将配置信息提供给其他 Istio 组件
  - 从底层平台（如 Kubernetes）中抽象平台特定的细节

## 流量管理组件

### 1. Gateway
- **作用**: 配置负载均衡器以接收入站或出站的 HTTP/TCP 连接
- **功能**:
  - 管理进入和离开网格的流量
  - 配置端口、协议、SNI（Server Name Indication）等
  - 与 Virtual Service 配合使用定义路由规则

### 2. Virtual Service
- **作用**: 定义一组流量路由规则
- **功能**:
  - 将请求路由到不同的服务版本
  - 实现 A/B 测试和金丝雀部署
  - 配置超时、重试和故障注入
  - 基于请求属性（如 headers、URI）进行路由

### 3. Destination Rule
- **作用**: 定义访问服务后应用的策略
- **功能**:
  - 配置负载均衡算法
  - 连接池设置
  - 异常检测设置
  - 定义服务子集（subset）

### 4. Service Entry
- **作用**: 将外部服务添加到 Istio 内部的服务注册表
- **功能**:
  - 管理网格外部服务的流量
  - 为外部服务启用 Istio 功能（如流量规则、安全策略等）

## 安全组件

### 1. PeerAuthentication
- **作用**: 定义服务间的身份验证策略
- **功能**:
  - 配置 mTLS（双向 TLS）策略
  - 设置 PERMISSIVE 或 STRICT 模式

### 2. RequestAuthentication
- **作用**: 定义最终用户的身份验证要求
- **功能**:
  - 验证 JWT（JSON Web Token）
  - 集成外部身份提供商

### 3. AuthorizationPolicy
- **作用**: 配置对服务的访问控制
- **功能**:
  - 基于来源、操作、条件的访问控制
  - 支持 ALLOW、DENY、AUDIT 和 CUSTOM 操作

## 可观测性组件

### 1. Telemetry
- **作用**: 配置遥测数据的收集和报告
- **功能**:
  - 自定义指标收集
  - 访问日志配置
  - 分布式追踪配置

### 2. 集成组件

#### Prometheus
- **作用**: 指标收集和存储
- **功能**: 收集来自 Envoy 代理和 Istio 组件的指标

#### Grafana
- **作用**: 指标可视化
- **功能**: 提供预配置的仪表板来可视化 Istio 指标

#### Jaeger
- **作用**: 分布式追踪
- **功能**: 跟踪请求在微服务架构中的完整路径

#### Kiali
- **作用**: 服务网格可视化
- **功能**:
  - 服务拓扑图
  - 流量流向可视化
  - 配置验证
  - 性能监控

## 高级组件

### 1. EnvoyFilter
- **作用**: 自定义 Envoy 配置
- **功能**:
  - 添加、修改或删除 Envoy 配置
  - 实现高级网络和 HTTP 过滤器功能

### 2. WorkloadEntry
- **作用**: 将非 Kubernetes 工作负载添加到网格
- **功能**:
  - 支持虚拟机和裸机服务
  - 扩展服务网格到 Kubernetes 之外

### 3. Sidecar
- **作用**: 配置 sidecar 代理的行为
- **功能**:
  - 限制 sidecar 代理的配置范围
  - 优化性能和资源使用

---

*最后更新时间: 2025-06-13*
